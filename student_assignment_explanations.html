<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment with Concept Explanations</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .assignment-section {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }
        .explanation-section {
            padding: 30px;
        }
        .detail-controls {
            margin-bottom: 20px;
            text-align: center;
        }
        .detail-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .detail-btn:hover {
            background: #5a6fd8;
        }
        .detail-btn.active {
            background: #764ba2;
        }
        .concept-card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .concept-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .concept-definition {
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
            margin-bottom: 15px;
        }
        .explanation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .explanation-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .explanation-card h4 {
            color: #667eea;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .explanation-card ul {
            padding-left: 20px;
        }
        .explanation-card li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .back-btn {
            background: #6c757d;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 5px;
            display: inline-block;
            margin-bottom: 20px;
            transition: background 0.3s;
        }
        .back-btn:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Assignment Learning Portal</h1>
            <p>Interactive Concept Explanations</p>
        </div>

        <div class="assignment-section">
            <a href="#" class="back-btn" onclick="history.back()">‚Üê Back to Assignments</a>
            <h2 id="assignment-title">Loading assignment...</h2>
            <p id="assignment-description">Loading description...</p>
            <div id="assignment-meta">
                <strong>Difficulty:</strong> <span id="assignment-difficulty">-</span> | 
                <strong>Concept:</strong> <span id="concept-name">-</span>
            </div>
        </div>

        <div class="explanation-section">
            <div class="detail-controls">
                <h3>Choose Explanation Detail Level:</h3>
                <button class="detail-btn" onclick="loadExplanation('basic')">Basic</button>
                <button class="detail-btn active" onclick="loadExplanation('medium')">Medium</button>
                <button class="detail-btn" onclick="loadExplanation('comprehensive')">Comprehensive</button>
            </div>

            <div id="loading" class="loading">
                <p>Loading concept explanations...</p>
            </div>

            <div id="error-message" class="error" style="display: none;"></div>

            <div id="explanation-content" style="display: none;">
                <div class="concept-card">
                    <div class="concept-title" id="concept-title">-</div>
                    <div class="concept-definition" id="concept-definition">-</div>
                </div>

                <div class="explanation-grid" id="explanation-grid">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script src="http://localhost:8001/student-api.js"></script>
    <script>
        let currentAssignmentId = null;
        let currentConceptId = null;

        // Get assignment ID from URL
        function getAssignmentIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('assignment_id');
        }

        // Load assignment details
        async function loadAssignmentDetails() {
            currentAssignmentId = getAssignmentIdFromUrl();
            if (!currentAssignmentId) {
                showError('No assignment ID provided');
                return;
            }

            try {
                const assignment = await studentAPI.getAssignment(currentAssignmentId);
                document.getElementById('assignment-title').textContent = assignment.title || 'Untitled Assignment';
                document.getElementById('assignment-description').textContent = assignment.description || 'No description available';
                document.getElementById('assignment-difficulty').textContent = assignment.difficulty_level || 'N/A';
                
                if (assignment.concept_id) {
                    currentConceptId = assignment.concept_id;
                    // Load medium level explanation by default
                    loadExplanation('medium');
                } else {
                    showError('No concept associated with this assignment');
                }
            } catch (error) {
                console.error('Error loading assignment:', error);
                showError('Failed to load assignment details');
            }
        }

        // Load concept explanation
        async function loadExplanation(detailLevel) {
            if (!currentAssignmentId) {
                showError('No assignment selected');
                return;
            }

            // Update button states
            document.querySelectorAll('.detail-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('explanation-content').style.display = 'none';

            try {
                const response = await studentAPI.getAssignmentConcepts(currentAssignmentId, detailLevel);
                
                if (response.success) {
                    displayExplanation(response.explanation, response.concept_name);
                } else {
                    showError('Failed to load concept explanation');
                }
            } catch (error) {
                console.error('Error loading explanation:', error);
                showError('Failed to load concept explanation: ' + error.message);
            }
        }

        // Display explanation content
        function displayExplanation(explanation, conceptName) {
            document.getElementById('concept-name').textContent = conceptName;
            document.getElementById('concept-title').textContent = explanation.title || conceptName;
            document.getElementById('concept-definition').textContent = explanation.definition || 'No definition available';

            const grid = document.getElementById('explanation-grid');
            grid.innerHTML = '';

            // Detailed explanation
            if (explanation.detailed_explanation) {
                addExplanationCard(grid, 'Detailed Explanation', 
                    `<p>${explanation.detailed_explanation}</p>`);
            }

            // Examples
            if (explanation.examples && explanation.examples.length > 0) {
                const examplesHtml = explanation.examples.map(ex => `<li>${ex}</li>`).join('');
                addExplanationCard(grid, 'Examples', `<ul>${examplesHtml}</ul>`);
            }

            // Key Points
            if (explanation.key_points && explanation.key_points.length > 0) {
                const pointsHtml = explanation.key_points.map(point => `<li>${point}</li>`).join('');
                addExplanationCard(grid, 'Key Points', `<ul>${pointsHtml}</ul>`);
            }

            // Prerequisites
            if (explanation.prerequisites && explanation.prerequisites.length > 0) {
                const prereqsHtml = explanation.prerequisites.map(prereq => `<li>${prereq}</li>`).join('');
                addExplanationCard(grid, 'Prerequisites', `<ul>${prereqsHtml}</ul>`);
            }

            // Step-by-step breakdown
            if (explanation.step_by_step_breakdown && explanation.step_by_step_breakdown.length > 0) {
                const stepsHtml = explanation.step_by_step_breakdown.map((step, index) => 
                    `<li><strong>Step ${index + 1}:</strong> ${step}</li>`
                ).join('');
                addExplanationCard(grid, 'Step-by-Step Guide', `<ul>${stepsHtml}</ul>`);
            }

            // Related Terms
            if (explanation.related_terms && explanation.related_terms.length > 0) {
                const termsHtml = explanation.related_terms.map(term => `<li>${term}</li>`).join('');
                addExplanationCard(grid, 'Related Terms', `<ul>${termsHtml}</ul>`);
            }

            // Applications
            if (explanation.applications && explanation.applications.length > 0) {
                const appsHtml = explanation.applications.map(app => `<li>${app}</li>`).join('');
                addExplanationCard(grid, 'Real-World Applications', `<ul>${appsHtml}</ul>`);
            }

            // Common Misconceptions
            if (explanation.common_misconceptions && explanation.common_misconceptions.length > 0) {
                const misconceptionsHtml = explanation.common_misconceptions.map(misconception => 
                    `<li>${misconception}</li>`
                ).join('');
                addExplanationCard(grid, 'Common Misconceptions', `<ul>${misconceptionsHtml}</ul>`);
            }

            // Hide loading, show content
            document.getElementById('loading').style.display = 'none';
            document.getElementById('explanation-content').style.display = 'block';
        }

        // Add explanation card to grid
        function addExplanationCard(grid, title, content) {
            const card = document.createElement('div');
            card.className = 'explanation-card';
            card.innerHTML = `
                <h4>${title}</h4>
                ${content}
            `;
            grid.appendChild(card);
        }

        // Show error message
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('explanation-content').style.display = 'none';
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-message').style.display = 'block';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadAssignmentDetails();
        });
    </script>
</body>
</html>
