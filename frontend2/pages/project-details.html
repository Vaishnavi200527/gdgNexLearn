<!DOCTYPE html>

<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>AMEP Project Detail (Dark Mode)</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<style>
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24;
            vertical-align: middle;
        }
        .glowing-title {
            text-shadow: 0 0 8px rgba(56, 250, 234, 0.5), 0 0 20px rgba(56, 250, 234, 0.3);
        }
        .glowing-button {
            box-shadow: 0 0 10px 0px rgba(56, 250, 234, 0.3), inset 0 0 10px 0px rgba(56, 250, 234, 0.2);
            transition: box-shadow 0.3s ease-in-out;
        }
        .glowing-button:hover {
            box-shadow: 0 0 15px 2px rgba(56, 250, 234, 0.6), inset 0 0 12px 0px rgba(56, 250, 234, 0.4);
        }
        .dark-glass {
            background-color: rgba(40, 59, 57, 0.5); /* #283B39 with 50% opacity */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 250, 234, 0.1);
        }
        .hidden {
            display: none;
        }
    </style>
<script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#38faea",
              "background-light": "#f5f8f8",
              "background-dark": "#0f2321",
            },
            fontFamily: {
              "display": ["Space Grotesk", "sans-serif"]
            },
            borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px"},
          },
        },
      }
    </script>
</head>
<body class="font-display bg-background-dark">
<div class="relative flex min-h-screen w-full flex-col text-white group/design-root overflow-x-hidden">
<div class="layout-container flex h-full grow flex-col">
<div class="flex flex-1 justify-center py-5">
<div class="layout-content-container flex flex-col w-full max-w-5xl px-4">
<!-- Top Nav Bar -->
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-primary/20 px-4 md:px-10 py-3">
<div class="flex items-center gap-4 text-white">
<div class="size-6 text-primary">
<svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M42.4379 44C42.4379 44 36.0744 33.9038 41.1692 24C46.8624 12.9336 42.2078 4 42.2078 4L7.01134 4C7.01134 4 11.6577 12.932 5.96912 23.9969C0.876273 33.9029 7.27094 44 7.27094 44L42.4379 44Z" fill="currentColor"></path>
</svg>
</div>
<h2 class="text-white text-lg font-bold leading-tight tracking-[-0.015em]">AMEP</h2>
</div>
<div class="hidden md:flex flex-1 justify-end gap-8">
<div class="flex items-center gap-9">
<a class="text-white/80 hover:text-primary transition-colors text-sm font-medium leading-normal" href="student-dashboard.html">Dashboard</a>
<a class="text-white/80 hover:text-primary transition-colors text-sm font-medium leading-normal" href="projects.html">Projects</a>
<a class="text-white/80 hover:text-primary transition-colors text-sm font-medium leading-normal" href="#">Community</a>
<a class="text-white/80 hover:text-primary transition-colors text-sm font-medium leading-normal" href="#">Resources</a>
</div>
<div class="flex gap-2">
<button class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-primary text-background-dark text-sm font-bold leading-normal tracking-[0.015em] glowing-button border border-primary/50">
<span class="truncate">Submit</span>
</button>
<button class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 bg-primary/20 text-white gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5 hover:bg-primary/30 transition-colors">
<span class="material-symbols-outlined text-primary" style="font-size: 20px;">notifications</span>
</button>
<button class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 bg-primary/20 text-white gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5 hover:bg-primary/30 transition-colors">
<span class="material-symbols-outlined text-primary" style="font-size: 20px;">settings</span>
</button>
</div>
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-primary/50" data-alt="User avatar image" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDdsVsxcJMKgcZY32vAE6PQTHlmjuOX9ShpLQTvAujvYcYgjkJk-Fsq3mBz_jNjX1CHxLMyMyjt5kCtFinoudHWorM7C73ypMXIEJjf6Fge3IXRh43YlswzKXr6YcmuLdYfPgQ7CCr1E3iRXkTGWMCAmbEC6S5XvVnZfCfNNGt9XEjebPP4hAmb88XW7Gs7n9C1KYzwv9sMtJ4ebD6G4tBX69UZdolNi2G0kfmQSzLWAtYthZKmGNle3Wk2e-2xbvLm-aWLW27lmVQ");'></div>
</div>
<button class="flex md:hidden max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 bg-primary/20 text-white gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5 hover:bg-primary/30 transition-colors">
<span class="material-symbols-outlined text-primary" style="font-size: 24px;">menu</span>
</button>
</header>
<main class="flex flex-col gap-8 mt-12">
<!-- Loading State -->
<div id="loading-state" class="flex justify-center items-center py-12">
    <div class="text-white text-lg">Loading project details...</div>
</div>

<!-- Project Content (Initially Hidden) -->
<div id="project-content" class="hidden">
    <!-- Page Heading -->
    <div class="flex flex-col items-center text-center gap-3 p-4">
        <p id="project-title" class="text-primary text-5xl md:text-6xl font-black leading-tight tracking-[-0.033em] glowing-title">Project Title</p>
        <p id="project-description" class="text-white/70 text-lg font-normal leading-normal max-w-2xl">Project description will appear here...</p>
    </div>
    <!-- Chips -->
    <div id="project-chips" class="flex gap-3 p-3 flex-wrap items-center justify-center">
        <!-- Chips will be populated dynamically -->
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left Column -->
    <div class="lg:col-span-2 flex flex-col gap-8">
    <!-- Project Description -->
    <section class="dark-glass p-6 rounded-xl flex flex-col gap-4">
    <h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Project Description</h2>
    <p id="project-full-description" class="text-white/80 text-base font-normal leading-relaxed">Detailed project description will appear here...</p>
    </section>
    <!-- Milestones/Checklist -->
    <section class="dark-glass p-6 rounded-xl flex flex-col gap-4">
    <h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Rubriks</h2>
    <ul id="milestones-list" class="space-y-4">
    <!-- Milestones will be populated dynamically -->
    <li class="text-center text-white/70 py-4">No rubriks defined yet</li>
    </ul>
    </section>
    </div>
    <!-- Right Column -->
    <div class="lg:col-span-1 flex flex-col gap-8">
    <!-- Progress Bar -->
    <section class="dark-glass p-6 rounded-xl flex flex-col gap-4">
    <h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em] pb-1">Project Progress</h2>
    <div class="flex flex-col gap-3">
    <div class="flex gap-6 justify-between items-baseline">
    <p class="text-white text-base font-medium leading-normal">Overall Completion</p>
    <p id="project-progress" class="text-primary text-lg font-bold leading-normal">0%</p>
    </div>
    <div class="rounded-full bg-primary/20 h-3 overflow-hidden">
    <div id="progress-bar" class="h-3 rounded-full bg-gradient-to-r from-[#00A8FF] to-primary" style="width: 0%;"></div>
    </div>
    </div>
    </section>
    <!-- Team Members -->
    <!-- <section class="dark-glass p-6 rounded-xl flex flex-col gap-4">
    <h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Team Members</h2>
    <div id="team-members" class="flex items-center space-x-2">
    <div class="text-center text-white/70 py-4">Team members will appear here</div>
    </div>
    </section> -->
    <!-- Action Bar -->
    <section class="dark-glass p-6 rounded-xl flex flex-col gap-4">
    <h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Actions</h2>
    <div class="flex flex-col gap-3">
    <!-- <button id="contribute-btn" class="flex w-full cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-12 px-4 bg-primary text-background-dark text-base font-bold tracking-wider glowing-button border border-primary/50">
    <span class="material-symbols-outlined">volunteer_activism</span>
    <span class="truncate">Contribute</span>
    </button> -->
    <button id="upload-btn" class="flex w-full cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-12 px-4 bg-transparent text-primary text-base font-bold border-2 border-primary/50 hover:bg-primary/10 transition-colors">
    <span class="material-symbols-outlined">upload_file</span>
    <span class="truncate">Upload Files</span>
    <!-- </button>
    <button id="chat-btn" class="flex w-full cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-12 px-4 bg-transparent text-primary text-base font-bold border-2 border-primary/50 hover:bg-primary/10 transition-colors">
    <span class="material-symbols-outlined">chat</span>
    <span class="truncate">Project Chat</span>
    </button> -->
    </div>
    </section>
    </div>
    </div>
</div>
</main>
</div>
</div>
</div>
</div>

<!-- File Upload Modal -->
<div id="upload-modal" class="fixed inset-0 bg-black/70 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-background-dark rounded-xl p-6 max-w-md w-full border border-primary/30">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-white">Upload Project Files</h3>
            <button id="close-modal" class="text-white/70 hover:text-white">&times;</button>
        </div>
        <div class="mb-4">
            <label class="block text-white mb-2">Select Files</label>
            <input type="file" id="file-upload" class="w-full text-white" multiple />
            <p class="text-sm text-white/70 mt-1">You can select multiple files to upload</p>
        </div>
        <div class="mb-4">
            <label class="block text-white mb-2">Submission Notes (Optional)</label>
            <textarea id="submission-notes" class="w-full p-2 rounded bg-background-dark border border-primary/30 text-white" rows="3" placeholder="Add any notes about your submission..."></textarea>
        </div>
        <div class="flex gap-3">
            <button id="submit-upload" class="flex-1 bg-primary text-background-dark py-2 rounded-lg font-bold hover:bg-primary/90 transition-colors">Submit</button>
            <button id="cancel-upload" class="flex-1 bg-background-dark text-primary py-2 rounded-lg font-bold border border-primary/50 hover:bg-primary/10 transition-colors">Cancel</button>
        </div>
    </div>
</div>

<script type="module">
    // Import required modules
    import { studentAPI } from '../src/services/api.js';
    import { logout } from '../src/services/auth.js';
    
    // Get project ID from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const projectId = urlParams.get('id');
    
    if (!projectId) {
        document.getElementById('loading-state').innerHTML = '<div class="text-red-500 text-center py-12">No project ID provided</div>';
        document.getElementById('loading-state').classList.remove('hidden');
        document.getElementById('project-content').classList.add('hidden');
        console.error('No project ID provided in URL');
        exit();
    }
    
    // Function to fetch project details
    async function fetchProjectDetails() {
        try {
            const response = await studentAPI.getProjectById(projectId);
            displayProjectDetails(response);
        } catch (error) {
            console.error('Error fetching project details:', error);
            document.getElementById('loading-state').innerHTML = '<div class="text-red-500 text-center py-12">Failed to load project details</div>';
            
            // Check if it's an authentication error
            if (error.message.includes('401') || error.message.includes('Unauthorized')) {
                console.log('Unauthorized. Redirecting to login...');
                window.location.href = 'login.html';
            }
        }
    }
    
    // Function to display project details
    function displayProjectDetails(project) {
        // Update the page with project data
        document.getElementById('project-title').textContent = project.title || 'Untitled Project';
        document.getElementById('project-description').textContent = project.description || 'No description provided.';
        document.getElementById('project-full-description').textContent = project.description || 'No description provided.';
        
        // Update chips
        const chipsContainer = document.getElementById('project-chips');
        chipsContainer.innerHTML = '';
        
        // Add status chip
        const statusChip = document.createElement('div');
        statusChip.className = 'flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-primary/20 text-primary px-4 border border-primary/30';
        statusChip.innerHTML = `
            <span class="material-symbols-outlined" style="font-size: 16px;">progress_activity</span>
            <p class="text-sm font-medium leading-normal">${project.status || project.project_status || 'Active'}</p>
        `;
        chipsContainer.appendChild(statusChip);
        
        // Add any additional tags/labels if available
        // Since the ProjectResponse schema might not have tags, we'll skip this for now
        
        // Display rubrics if available
        const rubricsList = document.getElementById('milestones-list');
        rubricsList.innerHTML = ''; // Clear existing content
        
        if (project.evaluation_rubric && project.evaluation_rubric.length > 0) {
            project.evaluation_rubric.forEach((criterion, index) => {
                const rubricItem = document.createElement('li');
                rubricItem.className = 'flex justify-between items-center p-3 bg-background-dark/50 rounded-lg border border-primary/20';
                
                const criterionText = document.createElement('span');
                criterionText.className = 'text-white';
                criterionText.textContent = criterion.criterion || criterion.title || criterion.name || 'Unnamed criterion';
                
                const weightText = document.createElement('span');
                weightText.className = 'text-primary font-bold';
                weightText.textContent = `${criterion.weight || criterion.value || 'N/A'}%`;
                
                rubricItem.appendChild(criterionText);
                rubricItem.appendChild(weightText);
                
                rubricsList.appendChild(rubricItem);
            });
        } else {
            // Show default message if no rubrics
            const noRubricsItem = document.createElement('li');
            noRubricsItem.className = 'text-center text-white/70 py-4';
            noRubricsItem.textContent = 'No rubrics defined for this project';
            rubricsList.appendChild(noRubricsItem);
        }
        
        // Show the project content and hide loading
        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('project-content').classList.remove('hidden');
    }
    
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        fetchProjectDetails();
        
        // Add event listeners for action buttons
        document.getElementById('upload-btn').addEventListener('click', function() {
            document.getElementById('upload-modal').classList.remove('hidden');
        });
        
        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('upload-modal').classList.add('hidden');
        });
        
        document.getElementById('cancel-upload').addEventListener('click', function() {
            document.getElementById('upload-modal').classList.add('hidden');
        });
        
        document.getElementById('submit-upload').addEventListener('click', async function() {
            const fileInput = document.getElementById('file-upload');
            const notesInput = document.getElementById('submission-notes');
            
            // If no files are selected, we can still submit with just notes
            if (fileInput.files.length === 0 && !notesInput.value.trim()) {
                alert('Please select a file to upload or add submission notes');
                return;
            }
            
            // Create FormData for file upload
            const formData = new FormData();
            
            // Append the file if selected
            if (fileInput.files.length > 0) {
                // For project submissions, we send one file at a time
                formData.append('file', fileInput.files[0]);
            }
            
            // Append submission notes
            if (notesInput.value) {
                formData.append('submission_notes', notesInput.value);
            }
            
            try {
                // Call the API to submit the project
                const response = await studentAPI.submitProject(projectId, formData);
                
                alert('Project submitted successfully!');
                document.getElementById('upload-modal').classList.add('hidden');
                
                // Reset form
                fileInput.value = '';
                notesInput.value = '';
                
                // Refresh project details to show updated status
                fetchProjectDetails();
            } catch (error) {
                console.error('Error submitting project:', error);
                alert('Error submitting project: ' + error.message);
            }
        });
    });
</script>
</body></html>